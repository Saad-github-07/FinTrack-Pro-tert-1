<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FinTrack Pro | Secure Vault</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade { animation: fadeIn 0.4s ease-out forwards; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 overflow-x-hidden">
    <div id="root">
        <!-- Loader during first boot -->
        <div class="h-screen flex flex-col items-center justify-center p-10 text-center">
            <div class="w-10 h-10 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin mb-4"></div>
            <p class="font-bold text-slate-400 text-[10px] tracking-widest uppercase">Initializing Secure Vault...</p>
        </div>
    </div>

    <!-- Firebase Compat Scripts -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- React and Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        // --- 1. CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyC9_YF2SZgJLr7pTc4W86T_80t_-vhDQ7A",
            authDomain: "shadow-fintrack-pro.firebaseapp.com",
            projectId: "shadow-fintrack-pro",
            storageBucket: "shadow-fintrack-pro.firebasestorage.app",
            messagingSenderId: "925057484980",
            appId: "1:925057484980:web:50e35903ab6890f004afe1",
            measurementId: "G-9BQXMHEWMV"
        };

        const ADMIN_WHITELIST = ["msajamadar@gmail.com"];

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        const { useState, useEffect, useMemo } = React;

        // Professional SVG Logo Component
        const Logo = ({ color = "#4F46E5" }) => (
            <svg viewBox="0 0 24 24" className="w-10 h-10" fill="none">
                <path d="M12 2L3 7V17L12 22L21 17V7L12 2Z" fill={color} fillOpacity="0.1" stroke={color} strokeWidth="2" strokeLinejoin="round"/>
                <path d="M12 22V12M12 12L21 7M12 12L3 7" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                <circle cx="12" cy="12" r="3" fill="white" stroke={color} strokeWidth="2"/>
            </svg>
        );

        function App() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [transactions, setTransactions] = useState([]);
            const [authMode, setAuthMode] = useState('login');
            const [authData, setAuthData] = useState({ email: '', password: '' });
            const [error, setError] = useState('');
            const [showModal, setShowModal] = useState(false);
            const [viewMode, setViewMode] = useState('list'); // 'list' or 'insights'
            const [activeTab, setActiveTab] = useState('all');
            const [isSubmitting, setIsSubmitting] = useState(false);

            const [formData, setFormData] = useState({
                type: 'expense', amount: '', category: 'Food', method: 'UPI', note: '', date: new Date().toISOString().split('T')[0]
            });

            // Auth Listener
            useEffect(() => {
                return auth.onAuthStateChanged((u) => {
                    if (u && !ADMIN_WHITELIST.includes(u.email.toLowerCase())) {
                        auth.signOut();
                        setError("Access Denied: Email not whitelisted.");
                        setUser(null);
                    } else {
                        setUser(u);
                        setError('');
                    }
                    setLoading(false);
                });
            }, []);

            // Data Sync
            useEffect(() => {
                if (!user) return;
                const path = `artifacts/fintrack-pro/users/${user.uid}/transactions`;
                return db.collection(path).onSnapshot((snapshot) => {
                    const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setTransactions(data.sort((a,b) => new Date(b.date) - new Date(a.date)));
                });
            }, [user]);

            const handleAuth = async (e) => {
                e.preventDefault();
                setError('');
                if (!ADMIN_WHITELIST.includes(authData.email.toLowerCase())) {
                    setError("Unauthorized email address.");
                    return;
                }
                setIsSubmitting(true);
                try {
                    if (authMode === 'login') {
                        await auth.signInWithEmailAndPassword(authData.email, authData.password);
                    } else {
                        await auth.createUserWithEmailAndPassword(authData.email, authData.password);
                    }
                } catch (err) {
                    setError(err.message.includes('invalid-credential') ? "Incorrect email or password." : err.message);
                } finally {
                    setIsSubmitting(false);
                }
            };

            const handleAdd = async (e) => {
                e.preventDefault();
                if (!formData.amount) return;
                setIsSubmitting(true);
                try {
                    const path = `artifacts/fintrack-pro/users/${user.uid}/transactions`;
                    await db.collection(path).add({
                        ...formData,
                        amount: parseFloat(formData.amount),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    setShowModal(false);
                    setFormData({ ...formData, amount: '', note: '', type: 'expense', category: 'Food', method: 'UPI', date: new Date().toISOString().split('T')[0] });
                } catch (err) { alert(err.message); }
                finally { setIsSubmitting(false); }
            };

            const deleteItem = async (id) => {
                if (!confirm("Are you sure you want to delete this record?")) return;
                const path = `artifacts/fintrack-pro/users/${user.uid}/transactions`;
                await db.collection(path).doc(id).delete();
            };

            const downloadCSV = () => {
                const headers = "Date,Type,Category,Method,Amount,Note\n";
                const rows = transactions.map(t => `${t.date},${t.type},${t.category},${t.method},${t.amount},"${t.note || ''}"`).join("\n");
                const blob = new Blob([headers + rows], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `FinTrack_Report_${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
            };

            const totals = useMemo(() => {
                return transactions.reduce((acc, t) => {
                    const amt = parseFloat(t.amount);
                    if (t.type === 'income') acc.income += amt;
                    else if (t.type === 'expense') acc.expense += amt;
                    else if (t.type === 'investment') acc.investment += amt;
                    return acc;
                }, { income: 0, expense: 0, investment: 0 });
            }, [transactions]);

            const categoryStats = useMemo(() => {
                return transactions.reduce((acc, t) => {
                    if (t.type !== 'expense') return acc;
                    acc[t.category] = (acc[t.category] || 0) + t.amount;
                    return acc;
                }, {});
            }, [transactions]);

            if (loading) return (
                <div className="h-screen flex flex-col items-center justify-center">
                    <div className="w-10 h-10 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin mb-4"></div>
                    <p className="font-bold text-slate-400 text-[10px] tracking-widest uppercase">Syncing...</p>
                </div>
            );

            if (!user) return (
                <div className="min-h-screen flex items-center justify-center p-6 bg-slate-50">
                    <div className="bg-white p-10 rounded-[2.5rem] shadow-2xl w-full max-w-md border border-slate-100 animate-fade">
                        <div className="flex justify-center mb-6"><Logo /></div>
                        <h2 className="text-3xl font-black text-center mb-1 tracking-tight text-slate-900">FinTrack Pro</h2>
                        <p className="text-slate-400 text-center mb-10 font-bold text-[10px] tracking-widest uppercase">Private Cloud Vault</p>
                        <form onSubmit={handleAuth} className="space-y-4">
  <input type="email" placeholder="Email Address" required className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold focus:ring-2 focus:ring-indigo-500 transition-all" onChange={e => setAuthData({...authData, email: e.target.value})} />
  <input type="password" placeholder="Password" required className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold focus:ring-2 focus:ring-indigo-500 transition-all" onChange={e => setAuthData({...authData, password: e.target.value})} />

  <p className="text-[9px] text-slate-400 font-bold uppercase tracking-widest text-center">
    For access issues, contact administrator
  </p>

  {error && <div className="p-4 bg-red-50 text-red-600 text-[10px] font-bold rounded-xl border border-red-100 uppercase tracking-tight">{error}</div>}
  <button disabled={isSubmitting} className="w-full bg-slate-900 text-white py-5 rounded-2xl font-black shadow-xl active:scale-95 transition-all">
    {isSubmitting ? '...' : (authMode === 'login' ? 'SIGN IN' : 'CREATE ACCOUNT')}
  </button>
</form>
                        
                        <button onClick={() => setAuthMode(authMode === 'login' ? 'signup' : 'login')} className="w-full mt-6 text-[10px] text-indigo-600 font-black uppercase tracking-widest">
                            {authMode === 'login' ? 'New User? Apply Here' : 'Back to Login'}
                        </button>
                    </div>
                </div>
            );

            return (
                <div className="max-w-md mx-auto min-h-screen pb-40 px-6 animate-fade">
                    <header className="flex justify-between items-center py-8">
                        <div className="flex items-center gap-3">
                            <Logo />
                            <h1 className="text-xl font-black tracking-tighter">FinTrack</h1>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={() => setViewMode(viewMode === 'list' ? 'insights' : 'list')} className={`p-3 rounded-2xl shadow-sm transition-all ${viewMode === 'insights' ? 'bg-indigo-600 text-white' : 'bg-white text-slate-400 border'}`}>
                                {viewMode === 'list' ? 'ðŸ“ˆ' : 'ðŸ“œ'}
                            </button>
                            <button onClick={() => auth.signOut()} className="px-4 py-2 bg-red-50 text-red-500 rounded-xl font-bold text-[10px] uppercase">Logout</button>
                        </div>
                    </header>

                    <section className="bg-slate-900 text-white p-8 rounded-[3.5rem] shadow-2xl relative overflow-hidden mb-8">
                        <div className="absolute top-0 right-0 w-32 h-32 bg-indigo-500/10 rounded-full blur-3xl -mr-10 -mt-10"></div>
                        <p className="text-slate-400 text-[10px] font-black uppercase tracking-[0.2em] mb-2">Net Worth Balance</p>
                        <h2 className="text-5xl font-black mb-10 tracking-tighter">â‚¹{(totals.income - totals.expense - totals.investment).toLocaleString()}</h2>
                        <div className="grid grid-cols-2 gap-4">
                            <div className="bg-white/5 p-4 rounded-3xl border border-white/5 backdrop-blur-md">
                                <span className="text-[9px] text-emerald-400 font-black uppercase">Total Inflow</span>
                                <p className="text-lg font-bold">â‚¹{totals.income.toLocaleString()}</p>
                            </div>
                            <div className="bg-white/5 p-4 rounded-3xl border border-white/5 backdrop-blur-md">
                                <span className="text-[9px] text-red-400 font-black uppercase">Total Spent</span>
                                <p className="text-lg font-bold">â‚¹{totals.expense.toLocaleString()}</p>
                            </div>
                        </div>
                    </section>

                    <div className="flex justify-between items-center mb-6">
                        <div className="flex gap-1.5 bg-slate-200/50 p-1.5 rounded-2xl">
                            {['all', 'income', 'expense', 'investment'].map(t => (
                                <button key={t} onClick={() => setActiveTab(t)} className={`px-4 py-2 text-[10px] font-black rounded-xl capitalize transition-all ${activeTab === t ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500'}`}>{t}</button>
                            ))}
                        </div>
                        <button onClick={downloadCSV} className="p-3 bg-white border rounded-2xl text-slate-400 shadow-sm active:scale-90 transition-all">ðŸ“¥</button>
                    </div>

                    {viewMode === 'insights' ? (
                        <div className="bg-white p-8 rounded-[3rem] border border-slate-100 shadow-sm animate-fade">
                            <h3 className="font-black text-xl mb-8 text-slate-800">Expense Analysis</h3>
                            {Object.entries(categoryStats).length === 0 ? <p className="text-center text-slate-300 italic py-10">Add expenses to see breakdown</p> : (
                                Object.entries(categoryStats).sort((a,b) => b[1] - a[1]).map(([cat, amt]) => {
                                    const perc = Math.round((amt / Math.max(1, totals.expense)) * 100);
                                    return (
                                        <div key={cat} className="mb-6">
                                            <div className="flex justify-between text-xs font-bold mb-2 uppercase tracking-wide text-slate-600"><span>{cat}</span><span>{perc}%</span></div>
                                            <div className="w-full h-2 bg-slate-50 rounded-full overflow-hidden border">
                                                <div className="h-full bg-indigo-500 rounded-full transition-all duration-1000" style={{ width: `${perc}%` }}></div>
                                            </div>
                                        </div>
                                    );
                                })
                            )}
                        </div>
                    ) : (
                        <div className="space-y-4">
                            {transactions.filter(t => activeTab === 'all' || t.type === activeTab).length === 0 ? (
                                <div className="text-center py-20 text-slate-300 font-bold uppercase tracking-widest text-[10px] italic">No records in this category</div>
                            ) : (
                                transactions.filter(t => activeTab === 'all' || t.type === activeTab).map(t => (
                                    <div key={t.id} className="bg-white p-5 rounded-[2.5rem] border flex justify-between items-center shadow-sm group hover:border-indigo-100 transition-all">
                                        <div className="flex items-center gap-4">
                                            <div className={`p-4 rounded-2xl ${t.type === 'income' ? 'bg-emerald-50 text-emerald-500' : t.type === 'expense' ? 'bg-indigo-50 text-indigo-500' : 'bg-amber-50 text-amber-500'}`}>
                                                {t.type === 'income' ? 'ðŸ“ˆ' : t.type === 'expense' ? 'ðŸ›’' : 'ðŸ’Ž'}
                                            </div>
                                            <div>
                                                <h4 className="font-bold text-sm leading-tight text-slate-800">{t.note || t.category}</h4>
                                                <p className="text-[9px] text-slate-400 font-black uppercase tracking-widest mt-1">{t.date} â€¢ {t.method}</p>
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-3">
                                            <span className={`font-black text-sm ${t.type === 'income' ? 'text-emerald-500' : 'text-slate-900'}`}>
                                                {t.type === 'income' ? '+' : '-'}â‚¹{t.amount.toLocaleString()}
                                            </span>
                                            <button onClick={() => deleteItem(t.id)} className="opacity-0 group-hover:opacity-100 p-1 text-slate-200 hover:text-red-500 transition-all ml-2">Ã—</button>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                    )}

                    <button onClick={() => setShowModal(true)} className="fixed bottom-10 right-8 bg-indigo-600 text-white w-16 h-16 rounded-[2.2rem] shadow-2xl text-4xl font-bold flex items-center justify-center active:scale-90 transition-all z-50 shadow-indigo-200">ï¼‹</button>

                                        {showModal && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[60] flex items-end sm:items-center justify-center p-4">
                            <div className="bg-white w-full max-w-md rounded-t-[3.5rem] sm:rounded-[3.5rem] p-10 shadow-2xl animate-in slide-in-from-bottom duration-300">
                                <div className="flex justify-between items-center mb-8"><h2 className="text-2xl font-black text-slate-900">Add Entry</h2><button onClick={() => setShowModal(false)} className="text-slate-400 font-bold">âœ•</button></div>
                                <form className="space-y-6" onSubmit={handleAdd}>
                                    <div className="flex gap-1.5 bg-slate-100 p-1.5 rounded-2xl">
                                        {['income', 'expense', 'investment'].map(type => (
                                            <button key={type} type="button" onClick={() => setFormData({...formData, type, category: type === 'income' ? 'Salary' : type === 'investment' ? 'Stocks' : 'Food'})} className={`flex-1 py-3 rounded-xl text-[10px] font-black capitalize transition-all ${formData.type === type ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-400'}`}>{type}</button>
                                        ))}
                                    </div>
                                    <div className="text-center">
                                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-2">Amount (â‚¹)</label>
                                        <input type="number" required placeholder="0" className="w-full text-5xl font-black text-center outline-none border-b-2 border-slate-50 focus:border-indigo-500 pb-2 transition-all" value={formData.amount} onChange={e => setFormData({...formData, amount: e.target.value})} />
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <select className="bg-slate-50 p-4 rounded-2xl font-bold border-none outline-none focus:ring-2 focus:ring-indigo-500 transition-all" value={formData.method} onChange={e => setFormData({...formData, method: e.target.value})}><option>UPI</option><option>Cash</option><option>Bank</option></select>
                                        <select className="bg-slate-50 p-4 rounded-2xl font-bold border-none outline-none focus:ring-2 focus:ring-indigo-500 transition-all" value={formData.category} onChange={e => setFormData({...formData, category: e.target.value})}>
                                            {formData.type === 'income' ? <><option>Salary</option><option>Freelance</option><option>Gift</option><option>Refund</option></> : formData.type === 'expense' ? <><option>Food</option><option>Transport</option><option>Shopping</option><option>Bills</option><option>Rent</option></> : <><option>Stocks</option><option>Mutual Funds</option><option>Gold</option><option>Crypto</option></>}
                                        </select>
                                    </div>
                                    <input type="text" placeholder="Add a note..." className="w-full bg-slate-50 p-4 rounded-2xl font-bold outline-none focus:ring-2 focus:ring-indigo-500 transition-all" value={formData.note} onChange={e => setFormData({...formData, note: e.target.value})} />
                                    <button disabled={isSubmitting} className="w-full bg-slate-900 text-white font-black py-5 rounded-3xl shadow-xl active:scale-95 transition-all">{isSubmitting ? 'SAVING...' : 'CONFIRM RECORD'}</button>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
